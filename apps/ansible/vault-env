#!/usr/bin/env bash
set -euo pipefail

secret="$(secret-tool lookup application ansible service vault username "$USER" || true)"

if [[ -z "${secret}" ]]; then
  cat >&2 <<EOF
No vault secret found in keyring.
Set it with:
  secret-tool store --label="Ansible vault secret" application ansible service vault username "$USER"
EOF
  exit 1
fi

# Print without adding a trailing newline (some tools care)
printf '%s' "$secret"
